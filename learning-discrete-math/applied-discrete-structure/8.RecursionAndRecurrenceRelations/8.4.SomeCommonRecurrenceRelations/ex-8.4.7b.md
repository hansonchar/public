# [8.4: Some Common Recurrence Relations](https://math.libretexts.org/Bookshelves/Combinatorics_and_Discrete_Mathematics/Applied_Discrete_Structures_(Doerr_and_Levasseur)/08%3A_Recursion_and_Recurrence_Relations/8.04%3A_Some_Common_Recurrence_Relations?readerView)

# Exercise 8.4.7b - Solving recurrence

Solve as completely as possible.

$$R_n = n + R_{\lfloor n/2\rfloor},\quad n\ge1, R_0=0$$

## Answer

Iterate a few terms and see the pattern.

$$\begin{align*}
R_0 &= 0 \\
R_1 &= 1 + R_0 = 1 = 1 + (2^0 - 1) \\
R_2 &= 2 + R_1 = 2 + 1 = 2 + (2^1 - 1) \\
R_3 &= 3 + R_1 = 3 + 1 = 3 + (2^1 - 1) \\
R_4 &= 4 + R_2 = 4 + (2 + 1) = 4 + (2^2 - 1) \\
R_5 &= 5 + R_2 = 5 + (2 + 1) = 5 + (2^2 - 1) \\
\vdots \\
R_8 &= 8 + R_4 = 8 + (4 + 2 + 1) = 8 + (2^3 - 1) \\
\end{align*}$$

Hence the conjecture:

$$R_n = n + 2^{\lfloor\log_2n\rfloor} - 1$$

### Verify with `sage`

```bash
# Recurrence function
def R(x):
    return 0 if x == 0 else x + R(floor(x/2))

# Conjecture
C(x) = x + 2^(floor(log(x, 2))) - 1
show(C) # or latex(C)
```

$$x \ {\mapsto}\ 2^{\left \lfloor \frac{\log\left(x\right)}{\log\left(2\right)} \right \rfloor} + x - 1$$

```bash
for i in range(1, 10):
    r = R(i)
    c = int(C(i))
    print(f'{i}: {r} == {c}: {r == c}')

1: 1 == 1: True
2: 3 == 3: True
3: 4 == 4: True
4: 7 == 7: True
5: 8 == 8: True
6: 10 == 9: False
7: 11 == 10: False
8: 15 == 15: True
9: 16 == 16: True
```

Oops, this doesn't hold in all cases.  Nice try but the recurrence remains unsolved.  A lot more interesting information about the sequence generated by this recurrence is available at [A005187](https://oeis.org/A005187).

### Generating function

Re-arranging the original equation, and translating it into generating functions:

$$\sum_{n=0}^\infty \left(R_n - R_{\lfloor{n\over2}\rfloor}\right)z^n = \sum_{n=0}^\infty n z^n$$

Let

$$G(R;z) = \sum_{n=0}^\infty R_n z^n$$

We see that

$$\begin{align*}
\sum_{n=0}^\infty R_{\lfloor{n\over2}\rfloor} &= R_1z^2 + R_1z^3 + R_2z^4 + R_2z^5 + \cdots + R_kz^{2k} + R_{k+1} z^{2k+1} + \cdots \\
&= \sum_{n=0}^\infty R_nz^{2n} + z\sum_{n=0}^\infty R_nz^{2n} \\
\end{align*}$$

whereas

$$\sum_{n=0}^\infty n z^n = {z\over(1-z)^2}$$

Therefore,

$$
G(R;z) - G(R;z^2) - zG(R;z^2) = {z\over(1-z)^2}
$$

Unfortunately, I have no idea how to proceed from here.
